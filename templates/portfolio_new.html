{% extends "base.html" %}
{% block title %}Create Portfolio{% endblock %}
{% block content %}
<div class="max-w-xl mx-auto">
    <h2 class="text-3xl font-bold mb-8">Create New Portfolio</h2>

    <form id="createPortfolioForm" class="bg-white p-8 rounded-lg shadow-lg">
        <div class="mb-6">
            <label for="name" class="block text-lg font-medium text-gray-700 mb-2">Portfolio Name</label>
            <input
                type="text"
                id="name"
                name="name"
                required
                placeholder="e.g., My Retirement Portfolio"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-lg"
            >
        </div>

        <div class="flex space-x-4">
            <button
                type="submit"
                class="flex-1 px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition"
            >
                Create Portfolio
            </button>
            <a
                href="/portfolios"
                class="px-6 py-3 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition text-center"
            >
                Cancel
            </a>
        </div>

        <div id="message" class="mt-4 hidden"></div>
    </form>
</div>

<script>
document.getElementById('createPortfolioForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = document.getElementById('name').value.trim();
    const messageDiv = document.getElementById('message');

    if (!name) {
        messageDiv.className = 'mt-4 p-4 bg-red-100 text-red-700 rounded-lg';
        messageDiv.textContent = 'Please enter a portfolio name';
        messageDiv.classList.remove('hidden');
        return;
    }

    try {
        const response = await fetch(`/api/portfolios/?name=${encodeURIComponent(name)}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        });

        if (response.ok) {
            const data = await response.json();
            messageDiv.className = 'mt-4 p-4 bg-green-100 text-green-700 rounded-lg';
            messageDiv.textContent = `Portfolio "${data.name}" created successfully!`;
            messageDiv.classList.remove('hidden');

            // Redirect after short delay
            setTimeout(() => {
                window.location.href = `/portfolios/${data.id}`;
            }, 1000);
        } else {
            const error = await response.json();
            throw new Error(error.detail || 'Failed to create portfolio');
        }
    } catch (err) {
        messageDiv.className = 'mt-4 p-4 bg-red-100 text-red-700 rounded-lg';
        messageDiv.textContent = err.message;
        messageDiv.classList.remove('hidden');
    }
});
</script>
{% endblock %}
